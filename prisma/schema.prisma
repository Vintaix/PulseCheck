generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==========================================
// JOUW APPLICATIE MODELLEN
// ==========================================

model User {
  id           String    @id @db.Uuid // Dit ID matcht met Supabase Auth, maar zonder harde DB-link
  email        String?
  name         String?
  passwordHint String?   @map("password_hint")
  role         Role      @default(EMPLOYEE)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  
  // Relaties en Foreign Keys
  companyId    String?   @map("company_id") @db.Uuid
  department   String?   @default("General")
  
  // Relaties
  company      Company?  @relation(fields: [companyId], references: [id], onUpdate: NoAction)
  
  Insight      Insight[]
  responses    Response[]

  @@map("profiles")
}

model Company {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String       @unique
  createdAt   DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  
  departments Department[]
  users       User[]       

  @@map("companies")
}

model Department {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId String    @map("company_id") @db.Uuid
  name      String
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([companyId, name])
  @@map("departments")
}

model Question {
  id        String       @id @default(uuid())
  text      String
  type      QuestionType
  isActive  Boolean      @default(false)
  order     Int          @default(0)
  responses Response[]
}

model Survey {
  id           String        @id @default(uuid())
  weekNumber   Int
  year         Int
  actionCaches ActionCache[]
  Insight      Insight[]
  responses    Response[]

  @@unique([weekNumber, year])
}

model Response {
  id           String   @id @default(uuid())
  userId       String   @map("user_id") @db.Uuid
  questionId   String
  surveyId     String
  valueNumeric Int?
  valueText    String?
  submittedAt  DateTime @default(now())
  
  question     Question @relation(fields: [questionId], references: [id])
  survey       Survey   @relation(fields: [surveyId], references: [id])
  user         User     @relation(fields: [userId], references: [id])

  @@unique([userId, questionId, surveyId])
  @@index([surveyId])
  @@index([questionId])
  @@index([userId])
}

model AIConfig {
  id             String   @id @default(uuid())
  key            String   @unique
  questionPrompt String   @default("Je bent een HR expert...")
  focusAreas     String?
  tone           String   @default("professioneel")
  language       String   @default("Nederlands")
  updatedAt      DateTime @default(now()) @updatedAt
  insightsPrompt String?
}

model Insight {
  id        String      @id @default(uuid())
  type      InsightType
  userId    String?     @map("user_id") @db.Uuid
  surveyId  String
  content   String
  createdAt DateTime    @default(now())
  language  String      @default("nl")
  
  survey    Survey      @relation(fields: [surveyId], references: [id])
  user      User?       @relation(fields: [userId], references: [id])

  @@unique([type, userId, surveyId, language])
  @@index([surveyId])
  @@index([userId])
}

model ActionCache {
  id          String   @id @default(uuid())
  surveyId    String
  actionsJson String
  createdAt   DateTime @default(now())
  language    String   @default("nl")
  survey      Survey   @relation(fields: [surveyId], references: [id])

  @@unique([surveyId, language])
}

model WeeklySentiment {
  id          String   @id @default(uuid())
  weekNumber  Int
  year        Int
  score       Int
  summary     String
  generatedAt DateTime @default(now())

  @@unique([weekNumber, year])
}

// ==========================================
// ENUMS
// ==========================================

enum Role {
  EMPLOYEE
  HR_MANAGER
}

enum QuestionType {
  SCALE_1_5
  OPEN
}

enum InsightType {
  EMPLOYEE
  TEAM
  COMPANY
}